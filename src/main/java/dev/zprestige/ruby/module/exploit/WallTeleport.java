package dev.zprestige.ruby.module.exploit;

import dev.zprestige.ruby.eventbus.annotation.RegisterListener;
import dev.zprestige.ruby.events.MoveEvent;
import dev.zprestige.ruby.module.Module;
import dev.zprestige.ruby.util.EntityUtil;
import dev.zprestige.ruby.util.Timer;
import net.minecraft.network.play.client.CPacketPlayer;

import java.util.Objects;

public class WallTeleport extends Module {
    public boolean hasCollided;
    public boolean willJump;
    public Timer jumpTimer = new Timer();

    @Override
    public void onTick() {
        if (mc.gameSettings.keyBindForward.isKeyDown() && mc.player.collidedHorizontally) {
            double[] speed = EntityUtil.getSpeed(0.001);
            if (willJump && !jumpTimer.getTime(100)) {
                mc.player.motionY = 0;
                mc.player.noClip = true;
            }
            mc.player.setPosition(mc.player.posX + speed[0], mc.player.posY, mc.player.posZ + speed[1]);
        }
        if (mc.player.collidedHorizontally && hasCollided) {
            Objects.requireNonNull(mc.getConnection()).sendPacket(new CPacketPlayer.Position(mc.player.posX, mc.player.posY + 0.1, mc.player.posZ, mc.player.onGround));
            hasCollided = false;
        }
    }

    @RegisterListener
    public void onMove(MoveEvent event) {
        if (nullCheck() || !isEnabled() || !mc.player.collidedHorizontally)
            return;
        event.setCancelled(true);
    }
}
